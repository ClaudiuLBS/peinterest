@model IEnumerable<Bookmark>
@using Microsoft.AspNetCore.Identity
@using Microsoft.AspNetCore.Mvc.TagHelpers`
@inject UserManager<AppUser> userManager

@{
    string? bookmarkId = Context.Request.Query["bookmarkId"];
    var bookmark = (
        from b in Model 
        where b.Id.ToString() == bookmarkId 
        select b
    ).FirstOrDefault();

    var userId = userManager.GetUserId(User);
}
<style>
    .my-modal {
        position: absolute;
        width: 60vw;
        height: 70vh;
        background: #ffffff;
        box-shadow: 1px 1px 10px 1px;
        border-radius: 5px;
        overflow: hidden;
        display: grid;
        grid-template-rows: 1fr 10fr 2fr;
        grid-template-columns: 1fr 1fr;
        grid-template-areas: 
           "header header"
           "img com"
           "img newcom";
    }
    .modal-img {
        flex: 1;
        max-width: 100%;
        max-height: 40vh;
        object-fit: contain;
    }
    #img-container {
        display: flex;
        align-items: center;
        justify-content: center;
        background: #000;
        grid-area: img;
    }
    #comment-section {
        display: flex;
        flex-direction: column;
        grid-area: comments;
        overflow-y: scroll;
        margin-bottom: .5em;
    }

    .my-header {
        display: flex !important;
        flex-direction: row !important;
        justify-content: space-between !important;
        padding: .5em 1em;
        align-items: center;
        background: #e9e9e9;
    }
    #right-modal {
        flex: 1;
        grid-area: com;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 1em;
        overflow-y: scroll;
        overflow-x: hidden;
    }
    .comm {
        border-radius: 5px;
        box-shadow: 1px 3px 10px .1px #a9a9a9;
        margin: .8em .5em;
    }
    .new-comm-box {
        grid-area: newcom;
        padding: 1em;
        width: 100%;
        background: #e9e9e9;
    }
</style>

@if (bookmark != null)
{
    <div class="my-modal">
        <div style="grid-area: header" class="my-header">
            <div>@bookmark.Title | @bookmark.User.UserName</div>
            <button type="button" onclick="closeBookmarkModal()" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div id="img-container">
            <img src="/images/@bookmark.Image" class="modal-img" alt="not found" />
            @await Html.PartialAsync("RatingComponent", bookmark)
        </div>
        <div id="right-modal">
            <div>
                <div class="comm" style="padding: 1em">
                    <p style="overflow-wrap: break-word">@bookmark.Description</p>
                </div>
                @foreach (var comment in bookmark.Comments)
                {
                    <div class="comm">
                        <div class="toast-header" style="padding-bottom: 0">
                            <strong class="me-auto">@comment.User.UserName</strong>
                            <small class="text-muted">@comment.CreatedAt.ToString()</small>
                        </div>
                        <div class="toast-body" style="padding-top: 0">
                            @comment.Content
                        </div>
                    </div>
                }
            </div>
        </div>
        <div class="new-comm-box">
            @await Html.PartialAsync("AddComment", bookmark)
        </div>
        <!--
        @if (bookmark.UserId == userId)
        {
            <form method="post" asp-controller="Bookmarks" asp-action="Delete" asp-route-bookmarkId="@bookmark.Id">
                <button type="submit">delete this shit</button>
            </form>
        }
        -->
    </div>
}
